<h1 id="a-quick-demo-showing-how-to-use-github-actions-to-build-package-and-publish-nodejs-modules-to-the-npm-and-github-package-registries">A quick demo showing how to use GitHub Actions to build, package, and publish Node.js modules to the NPM and GitHub package registries.</h1>

<p>This <a href="https://github.com/ULL-ESIT-PL-1920/lexer-generator">repo ULL-ESIT-PL-1920/lexer-generator</a> contains the solution code for
a Lab for the subject “Procesadores de Lenguajes” (Language Processors)
at Grado de Informatica de la ULL.</p>

<p>In branch <code class="language-plaintext highlighter-rouge">github-action-npm</code> I follow the YouTube tutorial
<a href="https://www.youtube.com/watch?v=9O2sLm1Boxc">A quick demo showing how to use GitHub Actions to build, package, and publish Node.js modules to the NPM and GitHub package registries.</a></p>

<p>Initially:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre><span class="c1"># This workflow will run tests using node and then publish a package to GitHub Packages when a release is created</span>
<span class="c1"># For more information see: https://help.github.com/actions/language-and-framework-guides/publishing-nodejs-packages</span>

<span class="na">name</span><span class="pi">:</span> <span class="s">Node.js Package</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">release</span><span class="pi">:</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">created</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">node-version</span><span class="pi">:</span> <span class="m">12</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">npm ci</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">npm test</span>

  <span class="na">publish-npm</span><span class="pi">:</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">build</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">node-version</span><span class="pi">:</span> <span class="m">12</span>
          <span class="na">registry-url</span><span class="pi">:</span> <span class="s">https://registry.npmjs.org/</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">npm ci</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">npm publish</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">NODE_AUTH_TOKEN</span><span class="pi">:</span> <span class="s">$</span>

  <span class="na">publish-gpr</span><span class="pi">:</span>
    <span class="na">needs</span><span class="pi">:</span> <span class="s">build</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v1</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">node-version</span><span class="pi">:</span> <span class="m">12</span>
          <span class="na">registry-url</span><span class="pi">:</span> <span class="s">https://npm.pkg.github.com/</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">npm ci</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">npm publish</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">NODE_AUTH_TOKEN</span><span class="pi">:</span> <span class="s">$</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="release">release</h2>

<p>Runs your workflow anytime the <code class="language-plaintext highlighter-rouge">release</code> event occurs. More than one activity type triggers this event. For information about the REST API, see “<a href="https://developer.github.com/v3/repos/releases/">Releases</a>” in the GitHub Developer documentation.</p>

<table>
<thead>
<tr>
<th>Webhook event payload</th>
<th>Activity types</th>
<th><code>GITHUB_SHA</code></th>
<th><code>GITHUB_REF</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://developer.github.com/v3/activity/events/types/#releaseevent"><code>release</code></a></td>
<td>- <code>published</code>, 
<br />
- <code>unpublished</code> 
<br />
- <code>created</code> 
<br />
- <code>edited</code> 
<br />
- <code>deleted</code> 
<br />
- <code>prereleased</code></td>
<td>Last commit in the tagged release</td>
<td>Tag of release</td>
</tr>
</tbody>
</table>

<p>For example, you can run a workflow when a release has been published.</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="na">on</span><span class="pi">:</span>
  <span class="na">release</span><span class="pi">:</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">published</span><span class="pi">]</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="npm-tokens">npm tokens</h2>

<ul>
  <li><a href="https://docs.npmjs.com/creating-and-viewing-authentication-tokens">Creating and viewing authentication tokens</a></li>
</ul>
