<!doctype html>
<html lang=" en-US ">

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=babaa336f8a720f00e147f7218073d2f98d1ba6e">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/assets/js/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/assets/css/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

</head>

<body>
    <div id="header">
        <nav>
  <ul>
    <li><a href="/search" title="search">&#x1F50D;</a></li>
    <!--
    <li><a href="#sytwstoc" title="Table of Contents">‚â°</a></li>
    -->

      
    <li><a href="/clases/2021/11/03/leccion.html" title="Previous">&#x2190;</a></li>
    
    
    <li><a href="/clases/2021/11/10/leccion.html" title="Next">&#x2192;</a></li>
    
    <li><a href="https://github.com/ULL-MII-SYTWS/ull-mii-sytws.github.io-source/tree/main//_posts/2021-11-08-leccion.md" title="Edit this page at GitHub">üêô</a>
    <li><a href="/references.html" title="Bibliograf√≠a">&#x1f4da</a></li>
    <li><a href="/practicas.html" title="Pr√°cticas">&#x270d</a></li>
    <li><a href="/clases.html" title="Clases">üë®‚Äçüè´</a></li>
    <li><a href="/" title="Home page">&#x1f3e0</a></li>
    <li><a href="/tema0-presentacion/" title="Tema 0: Presentaci√≥n">0</a></li>
    <li><a href="/tema1-introduccion/" title="Tema 1: Introducci√≥n">1</a></li>
    <li><a href="/tema2-async/" title="Tema 2: Async">2</a></li>
    <li><a href="/tema3-web/" title="Tema 3: Web">3</a></li>
    <li><a href="/tema4-devops/" title="Tema 4: Devop">4</a></li>
    
    </li>
    </ul>
</nav>

    </div>
    <!-- end header -->


    <div class="wrapper">

        <section>
            
<div id="title">
        <h1>Sistemas y Tecnolog√≠as Web: Servidor</h1>
        <p> Master de II. ULL. 1er cuatrimestre</p>
        <hr>
        <span class="credits left">Organization <a href="https://github.com/ULL-MII-SYTWS-2122" target="_blank">ULL-MII-SYTWS-2122</a></span>
        <span class="credits left"> &nbsp; Classroom <a href="https://classroom.github.com/classrooms/90842007-ull-mii-sytws-2122" target="_blank">ULL-MII-SYTWS-2122</a></span>
        <span class="credits left"> &nbsp; Campus Virtual <a href="https://campusdoctoradoyposgrado2122.ull.es/course/view.php?id=2122110810" target="_blank">SYTWS</a></span>
        <span class="credits left"> &nbsp; Chat <a href="https://chat.google.com/u/1/room/AAAAp18fCE8" target="_blank">Chat</a></span>
        <span class="credits left"> &nbsp; Profesor <a href="https://www.ull.es/apps/guias/guias/view_teacher_niu/837/crguezl/" target="_blank">Casiano</a></span>
    </div>

<!--

<div id="title">
    <h1>Sistemas y Tecnolog√≠as Web: Servidor</h1>
    <p> Master de II. ULL. 1er cuatrimestre</p>
    <hr>
    <span class="credits left">Organization <a href="https://github.com/ULL-MII-SYTWS"
            target="_blank">ULL-MII-SYTWS</a></span>
    <span class="credits left"> &nbsp; Github Classroom <a
            href="https://classroom.github.com/classrooms/55384072-master-de-ingenieria-informatica-sistemas-y-tecnologias-web-servidor-classroom"
            target="_blank">SYTWS 19/20</a></span>
    <span class="credits left"> &nbsp; Campus Virtual <a
            href="https://campusvirtual.ull.es/1920/course/view.php?id=201913778" target="_blank">SYTWS
            19/20</a></span>
    <span class="credits left"> &nbsp; Profesor <a
            href="https://www.ull.es/apps/guias/guias/view_teacher_niu/588/(%3FPcrguezl.*)/"" target="
            _blank">Casiano</a></span>
</div>
-->    

            
            



            <h2 >Table of Contents</h2>
            
            <ul id="sytwstoc">
  <li><a href="#exercises-on-asynchronous-js">Exercises on Asynchronous JS</a>
    <ul>
      <li><a href="#comparing-performances-sync-vs-async-and-rest-vs-graphql-in-the-gh-org-members-extension">Comparing Performances: Sync vs Async and REST vs GraphQL in the gh-org-members extension</a></li>
      <li><a href="#pagination-with-gh-api-graphql">Pagination with gh api graphql</a>
        <ul>
          <li><a href="#working-with-git-worktree">Working with git worktree</a></li>
        </ul>
      </li>
      <li><a href="#comparing-performances-in-the-gh-submodule-extension">Comparing Performances: In the gh-submodule extension</a></li>
      <li><a href="#both-parallel-and-unified-graphql-queries">Both Parallel and unified GraphQL queries</a></li>
    </ul>
  </li>
  <li><a href="#notes-about-the-lab-github-cli">Notes about the Lab ‚ÄúGitHub Cli‚Äù</a></li>
  <li><a href="#lab-graphql-simple-server">Lab: GraphQL-Simple-Server</a></li>
  <li><a href="#lab-npm-module">Lab: npm module</a></li>
  <li><a href="#lab-graphql-simple-client">Lab: GraphQL-Simple-Client</a></li>
  <li><a href="#references">References</a></li>
</ul>
          

            <div class="container"> 
                <h1> Clase  del Lunes 08/11/2021 (Semana C) </h1>
                <h2 id="exercises-on-asynchronous-js">Exercises on Asynchronous JS</h2>

<h3 id="comparing-performances-sync-vs-async-and-rest-vs-graphql-in-the-gh-org-members-extension">Comparing Performances: Sync vs Async and REST vs GraphQL in the gh-org-members extension</h3>

<p>V√©ase <a href="https://github.com/crguezl/gh-org-members/blob/main/gh-org-members.js">crguezl/gh-org-members/gh-org-members.js</a></p>

<p>This is an extension that shows information about the people inside an organization.
The initial version was written using the GitHub REST API. The performance was poor due to chaining of subsequent requests.
Parallelizing the requests to the REST API gave quite an improvement but changing to GraphQL was much better and since we were able to reduce all the 
REST requests  to a single GraphQL one  and furthermore 
we got rid of the need to use parallelism.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">REST Seq</th>
      <th style="text-align: center">REST Parallel</th>
      <th style="text-align: center">GraphQL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">12,754</td>
      <td style="text-align: center">3,3</td>
      <td style="text-align: center">1,5</td>
    </tr>
  </tbody>
</table>

<p>the sequential version is in the branch <code class="language-plaintext highlighter-rouge">sequential</code>:</p>

<h3 id="pagination-with-gh-api-graphql">Pagination with gh api graphql</h3>

<p>Forn the <code class="language-plaintext highlighter-rouge">gh help api</code>:</p>

<blockquote>
  <p>For GraphQL requests, ‚Ä¶
In <code class="language-plaintext highlighter-rouge">--paginate</code> mode, all pages of results will sequentially be requested until
there are no more pages of results. 
For GraphQL requests, this requires that the original query accepts an <code class="language-plaintext highlighter-rouge">$endCursor: String</code> variable and that it fetches the
<code class="language-plaintext highlighter-rouge">pageInfo{ hasNextPage, endCursor }</code> set of fields from a collection.</p>
</blockquote>

<h4 id="working-with-git-worktree">Working with git worktree</h4>

<p>A git repository can support multiple working trees, allowing you to check out more than one branch at a time.</p>

<p>With <a href="https://git-scm.com/docs/git-worktre">git worktree add</a> a new working tree is associated with the repository.</p>

<p>This new working tree is called a ‚Äú<em>linked working tree</em>‚Äù as opposed to the ‚Äú<em>main working tree</em>‚Äù prepared by <code class="language-plaintext highlighter-rouge">git-init</code> or <code class="language-plaintext highlighter-rouge">git-clone</code>.</p>

<p>A repository has one main working tree (if it‚Äôs not a bare repository) and zero or more linked working trees. When you are done with a linked working tree, remove it with <code class="language-plaintext highlighter-rouge">git worktree remove</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>$ git worktree add ../gh-org-members-seq sequential
$ code ../gh-org-members-seq
$ git branch -a
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If you want to know more about what the <code class="language-plaintext highlighter-rouge">git worktree</code> command does, see the video <em>Manage Branches easily using Git Worktree</em></p>

<!-- Courtesy of embedresponsively.com //-->

<div class="responsive-video-container">
    <iframe src="https://www.youtube-nocookie.com/embed/cRunWRC8ye0" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>
  </div>

<h3 id="comparing-performances-in-the-gh-submodule-extension">Comparing Performances: In the gh-submodule extension</h3>

<p>Improvement of the algorithm unifying in a single query all the queries to check when repos are empty. 
In the current version, the first query to make the search (option <code class="language-plaintext highlighter-rouge">-s</code>) is still implemetned using an API REST query,</p>

<p>Times for only queries to search for the repos and check what are empty:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">REST -n</th>
      <th style="text-align: center">GraphQL -n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">11,8</td>
      <td style="text-align: center">2,1</td>
    </tr>
  </tbody>
</table>

<p>Plus downloading 16 repos:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">REST</th>
      <th style="text-align: center">GraphQL</th>
      <th style="text-align: center">Parallel</th>
      <th style="text-align: center">Par and all GQL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">33,9</td>
      <td style="text-align: center">24</td>
      <td style="text-align: center">10,5</td>
      <td style="text-align: center">9,6</td>
    </tr>
  </tbody>
</table>

<p>The column para and all GQL corresponds to the version where all the queries are implemented using graphql (plus parallelism).
The best time for my laptop was obtained using 10 processes.</p>

<h3 id="both-parallel-and-unified-graphql-queries">Both Parallel and unified GraphQL queries</h3>

<p>The problem with parallelizing the downloads of submodules is that when we put concurrent <code class="language-plaintext highlighter-rouge">git submodule</code>s to work, <code class="language-plaintext highlighter-rouge">git</code>complains 
due to the race conditions that arise. Here is a capture of such kind of complaints:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>    Otro proceso git parece estar corriendo en el repositorio, es decir
    un editor abierto con 'git commit'. Por favor aseg√∫rese de que todos los procesos
    est√°n terminados y vuelve a intentar. Si el fallo permanece, un proceso git
    puede haber roto el repositorio antes:
    borra el archivo manualmente para continuar.
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Fortunately <code class="language-plaintext highlighter-rouge">git clone</code> can be done in parallel and so the idea was to make a parallel battery of  <code class="language-plaintext highlighter-rouge">git clone</code>s
and later to sequentially perform the <code class="language-plaintext highlighter-rouge">git submodule add</code> commands.</p>

<p>The man page says:</p>

<p><code class="language-plaintext highlighter-rouge">git submodule [-f|--force] [--name &lt;name&gt;] [--depth &lt;depth&gt;] [--] &lt;repository&gt; [&lt;path&gt;]</code></p>

<p>adds the given <code class="language-plaintext highlighter-rouge">&lt;repository&gt;</code> as a submodule at the given <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> to the <em>changeset</em> to be 
committed next to the current project: the current project is termed the <em>superproject</em>.</p>

<p><strong>If <code class="language-plaintext highlighter-rouge">&lt;path&gt;</code> exists and is already a valid Git repository, then it is staged for commit without cloning</strong>.</p>

<p>Since the repositories were cloned independently and later added as submodules the old setups have the submodules <code class="language-plaintext highlighter-rouge">.git</code> directory inside the submodule instead of embedded into the superprojects git directory which is the way submodules work.</p>

<p>This forces us to issue an additional <code class="language-plaintext highlighter-rouge">git submodule absorbgitdirs</code> commands per submodule folder.</p>

<p>This is what <code class="language-plaintext highlighter-rouge">git submodule absorbgitdirs</code> does:</p>

<blockquote>
  <p>If a <code class="language-plaintext highlighter-rouge">.git</code> directory of a submodule is inside the submodule, move the <code class="language-plaintext highlighter-rouge">.git</code> directory of the submodule into its superproject‚Äôs <code class="language-plaintext highlighter-rouge">.git/modules</code> path and
then connect the <code class="language-plaintext highlighter-rouge">.git</code> directory and its working directory by setting the <strong><code class="language-plaintext highlighter-rouge">core.worktree</code></strong>[^1] and adding a <code class="language-plaintext highlighter-rouge">.git</code> file pointing to the <code class="language-plaintext highlighter-rouge">.git</code> directory embedded
in the <em>superproject</em>s git directory.
This command is recursive by default.</p>
</blockquote>

<p>See also the question <a href="https://stackoverflow.com/questions/36386667/how-to-make-an-existing-directory-within-a-git-repository-a-git-submodule">https://stackoverflow.com/questions/36386667/how-to-make-an-existing-directory-within-a-git-repository-a-git-submodule</a></p>

<p>Here is a table  showing  the variation of the time in my laptop when the number of concurrent processes varies:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">1</th>
      <th style="text-align: center">2</th>
      <th style="text-align: center">3</th>
      <th style="text-align: center">4</th>
      <th style="text-align: center">5</th>
      <th style="text-align: center">6</th>
      <th style="text-align: center">7</th>
      <th style="text-align: center">8</th>
      <th style="text-align: center">9</th>
      <th style="text-align: center">10</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">23,4</td>
      <td style="text-align: center">16,</td>
      <td style="text-align: center">14,3</td>
      <td style="text-align: center">13,2</td>
      <td style="text-align: center">12,5</td>
      <td style="text-align: center">12,9</td>
      <td style="text-align: center">11,3</td>
      <td style="text-align: center">11,0</td>
      <td style="text-align: center">10,3</td>
      <td style="text-align: center">10,9</td>
    </tr>
  </tbody>
</table>

<h2 id="notes-about-the-lab-github-cli">Notes about the Lab ‚ÄúGitHub Cli‚Äù</h2>

<ul>
  <li><a href="/practicas/06p6-t1-gh-cli.html#extension">gh cli</a></li>
</ul>

<p>Some of you have already written a <a href="/tema1-introduccion/gh#extension">gh extension</a> using Node.JS. Let‚Äôs have a look at these.</p>

<p><strong>Instructions about the  delivery</strong>:</p>

<p>Create a repo for your extension in a repo <code class="language-plaintext highlighter-rouge">ULL-MII-SYTWS-2122/gh-my-extension-name</code>  inside the classroom organization <code class="language-plaintext highlighter-rouge">ULL-MII-SYTWS-2122</code>. Add that repo as a <code class="language-plaintext highlighter-rouge">git submodule</code> to the repo associated to this lab assignment. Just leave the link to the assignment and extensions repos in the campus virtual</p>

<h2 id="lab-graphql-simple-server">Lab: GraphQL-Simple-Server</h2>

<p>Continue studying the basics of express and GraphQL</p>

<ul>
  <li><a href="/practicas/graphql-simple-server/#resolvers">GraphQL-Simple-Server</a></li>
</ul>

<p>See the hello graphQL example at <a href="https://github.com/crguezl/learning-graphql-with-gh/tree/main/graphql-beginner-series">https://github.com/crguezl/learning-graphql-with-gh/tree/main/graphql-beginner-series</a></p>

<h2 id="lab-npm-module">Lab: npm module</h2>

<ul>
  <li><a href="/practicas/npm-module">npm module</a></li>
</ul>

<h2 id="lab-graphql-simple-client">Lab: GraphQL-Simple-Client</h2>

<ul>
  <li><a href="/practicas/graphql-simple-client/">GraphQL-Simple-Client</a></li>
</ul>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://graphql.org/learn/execution/">GraphQL: Execution</a></li>
</ul>


            </div>


                        
<h2>Comment with GitHub Utterances</h2>
            
<script src="https://utteranc.es/client.js"
        repo="ULL-MII-SYTWS/ull-mii-sytws.github.io"
        issue-term="pathname"
        label="SYTWS"
        theme="dark-blue"
        crossorigin="anonymous"
        async>
</script>
            



 
            
        </section>
    
    </div>


    
</body>

</html>
