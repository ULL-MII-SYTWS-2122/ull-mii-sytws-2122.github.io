<!doctype html>
<html lang=" en-US ">

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=040bfa3b3f7eb2e6744d975dbd481f0f056381f0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/assets/js/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/assets/css/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

</head>

<body>
    <div id="header">
        <nav>
  <ul>
    <li><a href="/search" title="search">&#x1F50D;</a></li>
    <!--
    <li><a href="#sytwstoc" title="Table of Contents">‚â°</a></li>
    -->

      
    <li><a href="/practicas/npm-module" title="Previous">&#x2190;</a></li>
    
    
    <li><a href="/practicas/graphql-subscriptions/" title="Next">&#x2192;</a></li>
    
    <li><a href="https://github.com/ULL-MII-SYTWS/ull-mii-sytws.github.io-source/tree/main//_practicas/19-graphql-simple-client.md" title="Edit this page at GitHub">üêô</a>
    <li><a href="/references.html" title="Bibliograf√≠a">&#x1f4da</a></li>
    <li><a href="/practicas.html" title="Pr√°cticas">&#x270d</a></li>
    <li><a href="/clases.html" title="Clases">üë®‚Äçüè´</a></li>
    <li><a href="/" title="Home page">&#x1f3e0</a></li>
    <li><a href="/tema0-presentacion/" title="Tema 0: Presentaci√≥n">0</a></li>
    <li><a href="/tema1-introduccion/" title="Tema 1: Introducci√≥n">1</a></li>
    <li><a href="/tema2-async/" title="Tema 2: Async">2</a></li>
    <li><a href="/tema3-web/" title="Tema 3: Web">3</a></li>
    <li><a href="/tema4-devops/" title="Tema 4: Devop">4</a></li>
    
    </li>
    </ul>
</nav>

    </div>
    <!-- end header -->


    <div class="wrapper">

        <section>
            
<div id="title">
        <h1>Sistemas y Tecnolog√≠as Web: Servidor</h1>
        <p> Master de II. ULL. 1er cuatrimestre</p>
        <hr>
        <span class="credits left">Organization <a href="https://github.com/ULL-MII-SYTWS-2122" target="_blank">ULL-MII-SYTWS-2122</a></span>
        <span class="credits left"> &nbsp; Classroom <a href="https://classroom.github.com/classrooms/90842007-ull-mii-sytws-2122" target="_blank">ULL-MII-SYTWS-2122</a></span>
        <span class="credits left"> &nbsp; Campus Virtual <a href="https://campusdoctoradoyposgrado2122.ull.es/course/view.php?id=2122110810" target="_blank">SYTWS</a></span>
        <span class="credits left"> &nbsp; Chat <a href="https://chat.google.com/u/1/room/AAAAp18fCE8" target="_blank">Chat</a></span>
        <span class="credits left"> &nbsp; Profesor <a href="https://www.ull.es/apps/guias/guias/view_teacher_niu/837/crguezl/" target="_blank">Casiano</a></span>
    </div>

<!--

<div id="title">
    <h1>Sistemas y Tecnolog√≠as Web: Servidor</h1>
    <p> Master de II. ULL. 1er cuatrimestre</p>
    <hr>
    <span class="credits left">Organization <a href="https://github.com/ULL-MII-SYTWS"
            target="_blank">ULL-MII-SYTWS</a></span>
    <span class="credits left"> &nbsp; Github Classroom <a
            href="https://classroom.github.com/classrooms/55384072-master-de-ingenieria-informatica-sistemas-y-tecnologias-web-servidor-classroom"
            target="_blank">SYTWS 19/20</a></span>
    <span class="credits left"> &nbsp; Campus Virtual <a
            href="https://campusvirtual.ull.es/1920/course/view.php?id=201913778" target="_blank">SYTWS
            19/20</a></span>
    <span class="credits left"> &nbsp; Profesor <a
            href="https://www.ull.es/apps/guias/guias/view_teacher_niu/588/(%3FPcrguezl.*)/"" target="
            _blank">Casiano</a></span>
</div>
-->    

            
            



            

            <div class="container"> 
                <h1> GraphQL-Simple-Client </h1>
                <h2 id="pr√°ctica-de-grupo-individual">Pr√°ctica de Grupo individual</h2>

<p>Al aceptar la asignaci√≥n se le pedir√° el nombre del equipo. Deber√° darle como nombre 
<code class="language-plaintext highlighter-rouge">Nombre-Apellidos-aluXXX</code> (sin acentos ni caracteres especiales). Los equipos son de un s√≥lo miembro.</p>

<h2 id="goal">Goal</h2>

<p>Write an express web app that shows the published GH cli extensions sorted by stars.
Use The GitHub GRaphQL API to get the data.</p>

<h2 id="basic-concepts-and-how-to">Basic Concepts and How To</h2>

<ul>
  <li><a href="https://docs.github.com/en/graphql/guides/introduction-to-graphql">GitHub Docs Introduction to GraphQL</a></li>
  <li><a href="https://docs.github.com/en/graphql/guides/forming-calls-with-graphql">GitHub Docs: Forming calls with GraphQL</a></li>
</ul>

<h2 id="libraries">Libraries</h2>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">()</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">ApolloClient</span><span class="p">,</span> <span class="nx">InMemoryCache</span><span class="p">,</span> <span class="nx">HttpLink</span><span class="p">,</span> <span class="nx">gql</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@apollo/client</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fetch</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">node-fetch</span><span class="dl">'</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="gql">gql</h2>

<p>The <code class="language-plaintext highlighter-rouge">gql</code> function is a tagged template literal. <a href="https://developer.mozilla.org/es/docs/Web/JavaScript/Reference/Template_literals">Tagged template literals</a> are literals delimited with backticks (`) that call a function (called the tag function) with</p>

<ol>
  <li>an array of any text segments from the literal followed by</li>
  <li>arguments with the values of any substitutions</li>
</ol>

<p><code class="language-plaintext highlighter-rouge">gql</code> returns the AST of the query. See this repl node session:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="o">&gt;</span> <span class="kd">let</span> <span class="p">{</span> <span class="nx">ApolloClient</span><span class="p">,</span> <span class="nx">InMemoryCache</span><span class="p">,</span> <span class="nx">HttpLink</span><span class="p">,</span> <span class="nx">gql</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">@apollo/client</span><span class="dl">'</span><span class="p">);</span>
<span class="kc">undefined</span>
<span class="o">&gt;</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">gql</span><span class="s2">`
... query GetDogs {
...     dogs {
.....       id
.....   }
... }
... `</span>
<span class="p">{</span>
  <span class="nl">kind</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Document</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">definitions</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">kind</span><span class="p">:</span> <span class="dl">'</span><span class="s1">OperationDefinition</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">operation</span><span class="p">:</span> <span class="dl">'</span><span class="s1">query</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">name</span><span class="p">:</span> <span class="p">[</span><span class="nb">Object</span><span class="p">],</span>
      <span class="na">variableDefinitions</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">directives</span><span class="p">:</span> <span class="p">[],</span>
      <span class="na">selectionSet</span><span class="p">:</span> <span class="p">[</span><span class="nb">Object</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">],</span>
  <span class="nx">loc</span><span class="p">:</span> <span class="p">{</span> <span class="nl">start</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">end</span><span class="p">:</span> <span class="mi">43</span> <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="getting-familiar-with-the-graphql-explorer">Getting Familiar with the GraphQL Explorer</h2>

<p>You can run queries on <strong>real GitHub data</strong> using the GraphQL Explorer, an integrated development environment in your browser that includes docs, syntax highlighting, and validation errors.</p>

<p>Visit <a href="https://docs.github.com/en/graphql/overview/explorer">https://docs.github.com/en/graphql/overview/explorer</a></p>

<h2 id="designing-the-search-query">Designing the <strong>search</strong> query</h2>

<p>Let us try to design a query to obtain the published GH Cli extensions sorted by stars.</p>

<p>Let us go to the <a href="https://docs.github.com/en/graphql/reference/queries#searchresultitemconnection">documentation for <code class="language-plaintext highlighter-rouge">search</code></a> in the GraphQL API. It give us s.t. like:</p>

<p><b>Type:</b> <a href="https://docs.github.com/en/graphql/reference/objects#searchresultitemconnection">SearchResultItemConnection!</a></p>

<table class="fields width-full">
<thead>
<tr>
  <th>Name</th>
  <th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><p><code>after</code> (<code><a href="https://docs.github.com/en/graphql/reference/scalars#string">String</a></code>)</p></td>
<td><p></p><p>Returns the elements in the list that come after the specified cursor.</p><p></p>
</td>
</tr><tr>
<td><p><code>before</code> (<code><a href="https://docs.github.com/en/graphql/reference/scalars#string">String</a></code>)</p></td>
<td><p></p><p>Returns the elements in the list that come before the specified cursor.</p><p></p>
</td>
</tr><tr>
<td><p><code>first</code> (<code><a href="https://docs.github.com/en/graphql/reference/scalars#int">Int</a></code>)</p></td>
<td><p></p><p>Returns the first <em>n</em> elements from the list.</p><p></p>
</td>
</tr><tr>
<td><p><code>last</code> (<code><a href="https://docs.github.com/en/graphql/reference/scalars#int">Int</a></code>)</p></td>
<td><p></p><p>Returns the last <em>n</em> elements from the list.</p><p></p>
</td>
</tr><tr>
<td><p><code>query</code> (<code><a href="https://docs.github.com/en/graphql/reference/scalars#string">String!</a></code>)</p></td>
<td><p></p><p>The search string to look for.</p><p></p>
</td>
</tr><tr>
<td><p><code>type</code> (<code><a href="https://docs.github.com/en/graphql/reference/enums#searchtype">SearchType!</a></code>)</p></td>
<td><p></p><p>The types of search items to search within.</p><p></p>
</td>
</tr></tbody>
</table>
<hr />

<p>We see also that result of a search has the type <a href="https://docs.github.com/en/graphql/reference/objects#searchresultitemconnection">SearchResultItemConnection</a> that describes the list of results that matched against our search query.</p>

<h2 id="searching-in-github">Searching in GitHub</h2>

<p>To fill the <code class="language-plaintext highlighter-rouge">query</code> field we need to find out how to search for <code class="language-plaintext highlighter-rouge">"gh-extensions"</code>.</p>

<p>Let us go to the GitHub docs for search syntax. We need to read:</p>

<ol>
  <li><a href="https://docs.github.com/en/search-github/getting-started-with-searching-on-github/understanding-the-search-syntax">Understanding the search syntax</a></li>
  <li><a href="https://docs.github.com/en/search-github/getting-started-with-searching-on-github/sorting-search-results">Sorting Search Results</a></li>
</ol>

<h3 id="exercise">Exercise</h3>

<p><strong><a href="https://github.com/search/advanced">Try different searches</a></strong> at <a href="https://github.com/search/advanced">https://github.com/search/advanced</a></p>

<ul>
  <li>Here is a <a href="/pages/solution-to-query-search-for-topic-in-github.md">Solution</a></li>
</ul>

<h2 id="the-searchresultitemconnection-type">The SearchResultItemConnection Type</h2>

<p>We see that result of a GraphQL search has the type <a href="https://docs.github.com/en/graphql/reference/objects#searchresultitemconnection">SearchResultItemConnection</a> that describes the list of results that matched against our search query.</p>

<p>These are the fields:</p>

<h4>Fields</h4>
<table class="fields width-full">
<thead>
<tr>  <th>Name</th>  <th>Description</th></tr>
</thead>
<tbody>

<tr><td><p><code>codeCount</code> (<code><a href="/en/graphql/reference/scalars#int">Int!</a></code>)</p></td>
<td><p></p><p>The number of pieces of code that matched the search query.</p><p></p></td></tr>

<tr><td><p><code>discussionCount</code> (<code><a href="/en/graphql/reference/scalars#int">Int!</a></code>)</p></td>
<td><p></p><p>The number of discussions that matched the search query.</p><p></p></td></tr>

<tr>
<td><p><code>edges</code> (<code><a href="/en/graphql/reference/objects#searchresultitemedge">[SearchResultItemEdge]</a></code>)</p></td>
<td><p></p><p>A list of edges.</p><p></p>
</td>
</tr>

<tr>
<td><p><code>issueCount</code> (<code><a href="/en/graphql/reference/scalars#int">Int!</a></code>)</p></td>
<td><p></p><p>The number of issues that matched the search query.</p><p></p>
</td>
</tr>

<tr>
<td><p><code>nodes</code> (<code><a href="/en/graphql/reference/unions#searchresultitem">[SearchResultItem]</a></code>)</p></td>
<td><p></p><p>A list of nodes.</p><p></p>
</td>
</tr>
<tr>
<td><p><code>pageInfo</code> (<code><a href="/en/graphql/reference/objects#pageinfo">PageInfo!</a></code>)</p></td>
<td><p></p><p>Information to aid in pagination.</p><p></p>
</td>
</tr>
<tr>
<td><p><code>repositoryCount</code> (<code><a href="/en/graphql/reference/scalars#int">Int!</a></code>)</p></td>
<td><p></p><p>The number of repositories that matched the search query.</p><p></p>
</td>
</tr>
<tr>
<td><p><code>userCount</code> (<code><a href="/en/graphql/reference/scalars#int">Int!</a></code>)</p></td>
<td><p></p><p>The number of users that matched the search query.</p><p></p>
</td>
</tr>
<tr>
<td><p><code>wikiCount</code> (<code><a href="/en/graphql/reference/scalars#int">Int!</a></code>)</p></td>
<td><p></p><p>The number of wiki pages that matched the search query.</p><p></p>
</td>
</tr>
</tbody>
</table>

<h2 id="connections">Connections</h2>

<p>The result type is a <a href="https://docs.github.com/en/graphql/reference/objects#searchresultitemconnection">SearchResultItemConnection</a> which means is a special kind of <strong>Connection</strong>.</p>

<p>The concept of <strong>Connection</strong> belongs to GraphQL.</p>

<p>A <strong>connection</strong> is a collection of objects with metadata such as <code class="language-plaintext highlighter-rouge">edges</code>, <code class="language-plaintext highlighter-rouge">pageInfo</code>, etc.</p>

<h3 id="pageinfo">pageInfo</h3>

<p>The <code class="language-plaintext highlighter-rouge">pageInfo</code> object contains information as</p>

<h4>Fields</h4>
<table class="fields width-full">
<thead>
<tr><th>Name</th><th>Description</th></tr>
</thead>
<tbody>
<tr>
<td><p><code>endCursor</code> (<code><a href="/en/graphql/reference/scalars#string">String</a></code>)</p></td>
<td><p></p><p>When paginating forwards, the cursor to continue.</p><p></p>
</td>
</tr>
<tr>
<td><p><code>hasNextPage</code> (<code><a href="/en/graphql/reference/scalars#boolean">Boolean!</a></code>)</p></td>
<td><p></p><p>When paginating forwards, are there more items?.</p><p></p>
</td>
</tr>
<tr>
<td><p><code>hasPreviousPage</code> (<code><a href="/en/graphql/reference/scalars#boolean">Boolean!</a></code>)</p></td>
<td><p></p><p>When paginating backwards, are there more items?.</p><p></p>
</td>
</tr>
<tr>
<td><p><code>startCursor</code> (<code><a href="/en/graphql/reference/scalars#string">String</a></code>)</p></td>
<td><p></p><p>When paginating backwards, the cursor to continue.</p><p></p>
</td>
</tr>
</tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">hasNextPage</code> will tell us if there are more <code class="language-plaintext highlighter-rouge">edges</code> available, or if we‚Äôve reached the end of this connection.</p>

<h3 id="the-array-of-records-edges">The array of records: edges</h3>

<p>Edges will provide us with flexibility to use our data.
In the  example of a search, the edges are of type <a href="https://docs.github.com/en/graphql/reference/objects#searchresultitemedge">SearchResultItemEdge</a></p>

<h4>Fields</h4>
<table class="fields width-full">
<thead>
<tr>
  <th>Name</th> <th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><code>cursor</code> (<code><a href="/en/graphql/reference/scalars#string">String!</a></code>)</p></td>
<td><p></p><p>A cursor for use in pagination.</p><p></p>
</td>
</tr>

<tr>
<td><p><code>node</code> (<code><a href="/en/graphql/reference/unions#searchresultitem">SearchResultItem</a></code>)</p></td>
<td><p></p><p>The item at the end of the edge.</p><p></p>
</td>
</tr>
<tr>
<td><p><code>textMatches</code> (<code><a href="/en/graphql/reference/objects#textmatch">[TextMatch]</a></code>)</p></td>
<td><p></p><p>Text matches on the result found.</p><p></p>
</td>
</tr>
</tbody>
</table>

<p><strong>edges</strong> will help us for the pagination: Each edge has a <code class="language-plaintext highlighter-rouge">node</code> which is a record or a data and a <code class="language-plaintext highlighter-rouge">cursor</code> that is a base64 encoded string to help relay with pagination.</p>

<h3 id="nodes">nodes</h3>

<p>In our example the nodes are of the type <a href="https://docs.github.com/en/graphql/reference/unions#searchresultitem">SearchResultItem</a> that can be almost anything since they are a union type.</p>

<h2 id="unions">unions</h2>

<p>Unions do not define any fields, <strong>so no fields may be queried on this type</strong> without the use of type <strong>refining fragments</strong> or <strong>inline fragments</strong><sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote">1</a></sup>.</p>

<h2 id="fragments">fragments</h2>

<p>Fragments are the primary unit of composition in GraphQL.</p>

<p>Fragments allow for the reuse of common repeated selections of fields, reducing duplicated text in the document. 
Inline Fragments can be used directly within a selection to condition upon a type condition when querying against an interface or union<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote">2</a></sup>.</p>

<p>For example,let‚Äôs say we had a page in our app, which lets us look at the marks of two students side by side. 
You can imagine that such a query implies to repeat the fields at least once - one for each side of the comparison.</p>

<pre><code class="language-gql">query compare2studentsNoFragment($id1: String!, $id2: String!) {
  
  left: student(AluXXXX: $id1) {
    Nombre
    AluXXXX
    markdown
  }
  
  right: student(AluXXXX: $id2) {
    Nombre
    AluXXXX
    markdown
  }
}
</code></pre>

<p>The repeated fields could be extracted into a fragment and composed by a parent fragment or query.</p>

<pre><code class="language-gql">fragment studentInfo on Student {
  Nombre
  AluXXXX
  markdown
}

query compare2students($id1: String!, $id2: String!) {
  # fragment example
  
  left: student(AluXXXX: $id1) {
    ... studentInfo
  }
  
  right: student(AluXXXX: $id2) {
    ... studentInfo
  }
}
</code></pre>

<h2 id="aliases">Aliases</h2>

<p>If you have a sharp eye, you may have noticed that, since the result object fields match the name of the field in the query but don‚Äôt include arguments, 
<strong>you can‚Äôt directly query for the same field with different arguments</strong>.</p>

<p>That‚Äôs why you need <strong>aliases</strong> - they let you rename the result of a field to anything you want. 
In the above example, thw two <code class="language-plaintext highlighter-rouge">student</code> fields would have conflicted, but 
since we can alias them to different names <code class="language-plaintext highlighter-rouge">left</code> and <code class="language-plaintext highlighter-rouge">right</code>, we can get both results in one request.</p>

<h2 id="default-values">Default Values</h2>

<p>Default values can also be assigned to the variables in the query by adding the default value after the type declaration.</p>

<pre><code class="language-gql">query getStudent($id1: String = "232566@studenti.unimore.it") {
  student(AluXXXX: $id1) {
    Nombre
    markdown
  }
}
</code></pre>

<h2 id="the-query">The query</h2>

<p>After what we have explained, we can make an attempt trying this query in the <a href="https://docs.github.com/en/graphql/overview/explorer">explorer</a>:</p>

<pre><code class="language-gql">{
  search(query: "topic:gh-extension sort:stars", type: REPOSITORY, first: 2 ) {
    repositoryCount
    pageInfo {
      hasNextPage
      endCursor
    }
    edges {
      cursor
      node {
        ... on Repository {
          nameWithOwner
          description
          url
          stargazers {
            totalCount
          }
        }
      }
    }
  }
}
</code></pre>

<p>that give us the number of repositories corresponding to gh-extensions.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"search"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"repositoryCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">111</span><span class="p">,</span><span class="w">
      </span><span class="nl">"pageInfo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"hasNextPage"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"endCursor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Y3Vyc29yOjI="</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"edges"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"cursor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Y3Vyc29yOjE="</span><span class="p">,</span><span class="w">
          </span><span class="nl">"node"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"nameWithOwner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mislav/gh-branch"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GitHub CLI extension for fuzzy finding, quickly switching between and deleting branches."</span><span class="p">,</span><span class="w">
            </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/mislav/gh-branch"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"stargazers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"totalCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">117</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"cursor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Y3Vyc29yOjI="</span><span class="p">,</span><span class="w">
          </span><span class="nl">"node"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"nameWithOwner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vilmibm/gh-screensaver"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"full terminal animations"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/vilmibm/gh-screensaver"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"stargazers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
              </span><span class="nl">"totalCount"</span><span class="p">:</span><span class="w"> </span><span class="mi">63</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Now we can use the <code class="language-plaintext highlighter-rouge">endCursor</code> to make the next request.</p>

<h2 id="building-the-apollo-client">Building the Apollo Client</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>const cache = new InMemoryCache();
const client = new ApolloClient({
  link: new HttpLink({
    uri: "https://api.github.com/graphql", 
    fetch, 
    headers: { 'Authorization': `Bearer ${process.env['GITHUB_TOKEN']}`, },
  }),
  cache
});
</pre></td></tr></tbody></table></code></pre></div></div>

<p><a href="https://www.apollographql.com/docs/react/api/link/apollo-link-http/">HttpLink</a> is a 
<a href="https://www.apollographql.com/docs/react/api/link/introduction/"><strong>terminating link</strong></a>
that sends a <strong>GraphQL operation</strong> to a remote endpoint over HTTP.</p>

<p><img src="/assets/images/graphql/graphql-chain-of.links.png" alt="" /></p>

<p>The HttpLink constructor takes an options object that can include:</p>

<ul>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">uri</code>  parameter is the URL of the GraphQL endpoint to send requests to. 
The default value is <code class="language-plaintext highlighter-rouge">/graphql</code>.</p>
  </li>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">fetch</code> parameter is a function to use instead of calling the Fetch API directly when sending HTTP requests to your GraphQL endpoint. The function must conform to the signature of <code class="language-plaintext highlighter-rouge">fetch</code>.</p>
  </li>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">headers</code> parameter is an object representing headers to include in every HTTP request.</p>
  </li>
</ul>

<h2 id="caching">Caching</h2>

<p>In an endpoint-based API, clients can use HTTP caching to easily avoid refetching resources, and for identifying when two resources are the same. The URL in these APIs is a globally unique identifier that the client can leverage to build a cache.</p>

<p>HTTP cache semantics allow for cacheable responses to be stored locally by clients, moving the cache away from the server-side and closer to the client for better performance and reduced network dependence.</p>

<p>To support this, HTTP makes available several caching options through the <code class="language-plaintext highlighter-rouge">Cache-Control</code> response header that defines if the response is cacheable and, if so, for how long. Responses may only be cached if the HTTP method is <code class="language-plaintext highlighter-rouge">GET</code> or <code class="language-plaintext highlighter-rouge">HEAD</code> and the proper <code class="language-plaintext highlighter-rouge">Cache-Control</code> header indicates the content is cacheable.</p>

<p>In GraphQL, though, there‚Äôs no URL-like primitive that provides this globally unique identifier for a given object. It‚Äôs hence a best practice for the API to expose such an identifier for clients to use.</p>

<p>See the section <a href="https://www.apollographql.com/docs/react/caching/overview/">Caching in Apollo Client</a> for  details on how the Apollo Client
stores the results of your GraphQL queries in a local, <a href="https://www.apollographql.com/docs/react/caching/overview/#data-normalization">normalized</a>, in-memory cache. This enables Apollo Client to respond immediately to queries for already-cached data, without  sending a network request.</p>

<h2 id="pagination">Pagination</h2>

<p>See <a href="https://www.apollographql.com/docs/react/pagination/overview/">Pagination in Apollo Client</a></p>

<h2 id="express-routes">Express Routes</h2>

<p>Now the handler for requests to the main  <code class="language-plaintext highlighter-rouge">/</code> route is simple:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre> <span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">client</span>
    <span class="p">.</span><span class="nx">query</span><span class="p">({</span><span class="na">query</span><span class="p">:</span> <span class="nx">firstQuery</span><span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">queryRes</span> <span class="o">=&gt;</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">queryRes</span><span class="p">))</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>We make the GraphQL query <code class="language-plaintext highlighter-rouge">firstQuery</code> using the <code class="language-plaintext highlighter-rouge">query</code> method of the ApolloClient <code class="language-plaintext highlighter-rouge">client</code>
that it is sent to the GitHub GraphQL API endpoint. It returns a Promise. 
When the promise is fulfilled, we get in the variable <code class="language-plaintext highlighter-rouge">queryRes</code> the response of the GitHub server.
We pass both our object <code class="language-plaintext highlighter-rouge">res</code> to elaborate the response and the <code class="language-plaintext highlighter-rouge">queryRes</code> 
object to our <code class="language-plaintext highlighter-rouge">handler</code> function that renders the results of the query:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">handler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">search</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">repos</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">edges</span><span class="p">;</span>
  <span class="kd">const</span> <span class="nx">repoCount</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">repositoryCount</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">pageInfo</span><span class="p">.</span><span class="nx">hasNextPage</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">lastCursor</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">pageInfo</span><span class="p">.</span><span class="nx">endCursor</span><span class="p">;</span> 
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="dl">'</span><span class="s1">pages/index</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="na">repos</span><span class="p">:</span> <span class="nx">repos</span><span class="p">,</span> <span class="na">lastCursor</span><span class="p">:</span> <span class="nx">lastCursor</span><span class="p">});</span>
  <span class="p">}</span> 
<span class="p">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>The first call to <code class="language-plaintext highlighter-rouge">handler</code> gets the array <code class="language-plaintext highlighter-rouge">repos</code> 
corresponding to the first page of json objects describing the matching repositories.
Then it computes <code class="language-plaintext highlighter-rouge">lastCursor</code>, the cursor of the last item in the incoming page.
Both the array <code class="language-plaintext highlighter-rouge">repos</code> and <code class="language-plaintext highlighter-rouge">lastCursor</code> are passed to the view in  <code class="language-plaintext highlighter-rouge">views/pages/index.ejs</code>:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;</span><span class="err">%</span><span class="na">-</span> <span class="na">include</span><span class="err">('../</span><span class="na">partials</span><span class="err">/</span><span class="na">head</span><span class="err">');</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>

<span class="nt">&lt;header&gt;</span>
  <span class="nt">&lt;</span><span class="err">%</span><span class="na">-</span> <span class="na">include</span><span class="err">('../</span><span class="na">partials</span><span class="err">/</span><span class="na">header</span><span class="err">');</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/header&gt;</span>

<span class="nt">&lt;main&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"jumbotron"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Most Starred GitHub Cli Extensions<span class="nt">&lt;/h1&gt;</span>
   
      <span class="nt">&lt;ol</span> <span class="na">start=</span><span class="s">"&lt;%= offset %&gt;"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;</span><span class="err">%</span> <span class="na">repos.forEach</span><span class="err">(</span><span class="na">function</span><span class="err">(</span><span class="na">repo</span><span class="err">)</span> <span class="err">{</span> <span class="err">%</span><span class="nt">&gt;</span>
          <span class="nt">&lt;li&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"&lt;%= repo.node.url %&gt;"</span> <span class="na">target=</span><span class="s">"_blank"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;strong&gt;&lt;</span><span class="err">%=</span> <span class="na">repo.node.nameWithOwner</span> <span class="err">%</span><span class="nt">&gt;&lt;/strong&gt;</span>
            <span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">repo.node.description</span> <span class="err">%</span><span class="nt">&gt;</span>
          <span class="nt">&lt;/li&gt;</span>
        <span class="nt">&lt;</span><span class="err">%</span> <span class="err">});</span> <span class="err">%</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/ol&gt;</span>
 
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/next/&lt;%= lastCursor %&gt;"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-sm float-right"</span><span class="nt">&gt;</span>Next extensions<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;/a&gt;</span>
 
<span class="nt">&lt;/main&gt;</span>

<span class="nt">&lt;footer&gt;</span>
  <span class="nt">&lt;</span><span class="err">%</span><span class="na">-</span> <span class="na">include</span><span class="err">('../</span><span class="na">partials</span><span class="err">/</span><span class="na">footer</span><span class="err">');</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/footer&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>       
</pre></td></tr></tbody></table></code></pre></div></div>

<p>A request to the route <code class="language-plaintext highlighter-rouge">/next/:cursor</code> is sent when the link button 
to get the next page of gh cli extensions is clicked. The parameter <code class="language-plaintext highlighter-rouge">:cursor</code> is 
filled with the value of the last cursor of the previous page.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/next/:cursor</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">client</span>
    <span class="p">.</span><span class="nx">query</span><span class="p">({</span> <span class="na">query</span><span class="p">:</span> <span class="nx">subsequentQueries</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">cursor</span><span class="p">)})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">queryRes</span> <span class="o">=&gt;</span> <span class="nx">handler</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span><span class="nx">queryRes</span><span class="p">))</span>
    <span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>where <code class="language-plaintext highlighter-rouge">subsequentQueries</code> only differs from the first query in the <code class="language-plaintext highlighter-rouge">after: $cursor</code> argument:</p>

<pre><code class="language-gql">{
  search(query: "topic:gh-extension sort:stars", type: REPOSITORY, first: 2, after: $cursor) {
    repositoryCount
    pageInfo {
      hasNextPage
      endCursor
    }
    edges {
      ...
    }
  }
}
</code></pre>

<p>After we set the <code class="language-plaintext highlighter-rouge">app</code> to listen for requests</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">7000</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`App listening on port 7000!`</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>we can visit the page with our browser:</p>

<p><img src="/assets/images/most-starred-github-cli-extensions.png" alt="" /></p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://docs.github.com/en/graphql/guides/introduction-to-graphql">GitHub Docs Introduction to GraphQL</a></li>
  <li><a href="https://docs.github.com/en/graphql/guides/forming-calls-with-graphql">GitHub Docs: Forming calls with GraphQL</a></li>
  <li><a href="https://youtu.be/DyvsMKsEsyE">GraphQL Hello World</a>. A YouTube list of videos by Ben Awad
    <ul>
      <li><a href="https://youtu.be/pI5CKxyrbiI">How GraphQL Resolvers Work</a></li>
    </ul>
  </li>
  <li>Apollo Client API Core
    <ul>
      <li><a href="https://www.apollographql.com/docs/react/api/core/ApolloClient/">ApolloClient</a></li>
      <li><a href="https://www.apollographql.com/docs/react/api/cache/InMemoryCache/">InMemoryCache</a></li>
      <li><a href="https://www.apollographql.com/docs/react/api/core/ObservableQuery/">ObservableQuery</a></li>
      <li><a href="https://www.apollographql.com/docs/react/api/core/ApolloClient/#ApolloClient.query"><code class="language-plaintext highlighter-rouge">query(options): Promise&lt;ApolloQueryResult&gt;</code></a></li>
    </ul>
  </li>
  <li><a href="https://graphql.org/learn/caching/">Caching in GraphQL</a>
    <ul>
      <li><a href="https://www.apollographql.com/docs/react/caching/overview/">Caching in Apollo Client</a></li>
    </ul>
  </li>
</ul>

<h2 id="footnotes">Footnotes</h2>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>https://spec.graphql.org/June2018/#sec-Unions¬†<a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>https://spec.graphql.org/June2018/#sec-Language.Fragments¬†<a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>









            </div>


                        
<h2>Comment with GitHub Utterances</h2>
            
<script src="https://utteranc.es/client.js"
        repo="ULL-MII-SYTWS/ull-mii-sytws.github.io"
        issue-term="pathname"
        label="SYTWS"
        theme="dark-blue"
        crossorigin="anonymous"
        async>
</script>
            



 
            
        </section>
    
    </div>


    
</body>

</html>
