<!doctype html>
<html lang=" en-US ">

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=c90537a56cb8cbe080915d57e715aa5d492f37bd">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/assets/js/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/assets/css/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

</head>

<body>
    <div id="header">
        <nav>
  <ul>
    <li><a href="/search" title="search">&#x1F50D;</a></li>
    <!--
    <li><a href="#sytwstoc" title="Table of Contents">‚â°</a></li>
    -->

      
    <li><a href="/practicas/07p7-t2-asyncmap.html" title="Previous">&#x2190;</a></li>
    
    
    <li><a href="/practicas/09p9-t2-promise-readfile.html" title="Next">&#x2192;</a></li>
    
    <li><a href="https://github.com/ULL-MII-SYTWS/ull-mii-sytws.github.io-source/tree/main//_practicas/08p8-t2-async-serialize.md" title="Edit this page at GitHub">üêô</a>
    <li><a href="/references.html" title="Bibliograf√≠a">&#x1f4da</a></li>
    <li><a href="/practicas.html" title="Pr√°cticas">&#x270d</a></li>
    <li><a href="/clases.html" title="Clases">üë®‚Äçüè´</a></li>
    <li><a href="/" title="Home page">&#x1f3e0</a></li>
    <li><a href="/tema0-presentacion/" title="Tema 0: Presentaci√≥n">0</a></li>
    <li><a href="/tema1-introduccion/" title="Tema 1: Introducci√≥n">1</a></li>
    <li><a href="/tema2-async/" title="Tema 2: Async">2</a></li>
    <li><a href="/tema3-web/" title="Tema 3: Web">3</a></li>
    <li><a href="/tema4-devops/" title="Tema 4: Devop">4</a></li>
    
    </li>
    </ul>
</nav>

    </div>
    <!-- end header -->


    <div class="wrapper">

        <section>
            
<div id="title">
        <h1>Sistemas y Tecnolog√≠as Web: Servidor</h1>
        <p> Master de II. ULL. 1er cuatrimestre</p>
        <hr>
        <span class="credits left">Organization <a href="https://github.com/ULL-MII-SYTWS-2122" target="_blank">ULL-MII-SYTWS-2122</a></span>
        <span class="credits left"> &nbsp; Classroom <a href="https://classroom.github.com/classrooms/90842007-ull-mii-sytws-2122" target="_blank">ULL-MII-SYTWS-2122</a></span>
        <span class="credits left"> &nbsp; Campus Virtual <a href="https://campusdoctoradoyposgrado2122.ull.es/course/view.php?id=2122110810" target="_blank">SYTWS</a></span>
        <span class="credits left"> &nbsp; Chat <a href="https://chat.google.com/u/1/room/AAAAp18fCE8" target="_blank">Chat</a></span>
        <span class="credits left"> &nbsp; Profesor <a href="https://www.ull.es/apps/guias/guias/view_teacher_niu/837/crguezl/" target="_blank">Casiano</a></span>
    </div>

<!--

<div id="title">
    <h1>Sistemas y Tecnolog√≠as Web: Servidor</h1>
    <p> Master de II. ULL. 1er cuatrimestre</p>
    <hr>
    <span class="credits left">Organization <a href="https://github.com/ULL-MII-SYTWS"
            target="_blank">ULL-MII-SYTWS</a></span>
    <span class="credits left"> &nbsp; Github Classroom <a
            href="https://classroom.github.com/classrooms/55384072-master-de-ingenieria-informatica-sistemas-y-tecnologias-web-servidor-classroom"
            target="_blank">SYTWS 19/20</a></span>
    <span class="credits left"> &nbsp; Campus Virtual <a
            href="https://campusvirtual.ull.es/1920/course/view.php?id=201913778" target="_blank">SYTWS
            19/20</a></span>
    <span class="credits left"> &nbsp; Profesor <a
            href="https://www.ull.es/apps/guias/guias/view_teacher_niu/588/(%3FPcrguezl.*)/"" target="
            _blank">Casiano</a></span>
</div>
-->    

            
            



            <h2 >Table of Contents</h2>
            
            <ul id="sytwstoc">
  <li><a href="#introducci√≥n">Introducci√≥n</a></li>
  <li><a href="#javascript-is-single-thread-but-the-browser-isnt">JavaScript is Single Thread but the Browser Isn‚Äôt</a></li>
  <li><a href="#escriba-una-funci√≥n-loadscripts">Escriba una funci√≥n <code class="language-plaintext highlighter-rouge">loadScripts</code></a></li>
  <li><a href="#serializaci√≥n-de-callbacks">Serializaci√≥n de Callbacks</a>
    <ul>
      <li><a href="#ejemplos-de-prueba">Ejemplos de prueba</a></li>
    </ul>
  </li>
  <li><a href="#usando-el-m√≥dulo-npm-async-en-el-navegador">Usando el M√≥dulo npm Async en el Navegador</a></li>
  <li><a href="#bundlers">Bundlers</a>
    <ul>
      <li><a href="#webpack">Webpack</a></li>
      <li><a href="#webpackconfigjs">webpack.config.js</a></li>
      <li><a href="#packaging-all-modules-in-a-single-js-file">Packaging all modules in a single JS file</a></li>
      <li><a href="#webpack-loaders">Webpack Loaders</a></li>
      <li><a href="#debugging-con-webpack">Debugging con Webpack</a></li>
    </ul>
  </li>
  <li><a href="#escriba-su-soluci√≥n-como-un-m√≥dulo-es6">Escriba su soluci√≥n como un m√≥dulo es6</a></li>
  <li><a href="#referencias">Referencias</a></li>
  <li><a href="#rubrica">R√∫brica</a></li>
</ul>
          

            <div class="container"> 
                <h1> Async Serialize </h1>
                <h2 id="introducci√≥n">Introducci√≥n</h2>

<p>Encontrar√° parte del material de esta pr√°ctica en el <a href="https://github.com/ULL-ESIT-PL/async-js-series-webpack">Repo ULL-ESIT-PL/async-js-series-webpack</a>.</p>

<p>Se dispone de una funci√≥n <code class="language-plaintext highlighter-rouge">loadScript</code> que permite la carga de un script:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>    <span class="kd">function</span> <span class="nx">loadScript</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">src</span><span class="p">;</span>
      
        <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">script</span><span class="p">);</span>
        <span class="nx">script</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">`Script load error for </span><span class="p">${</span><span class="nx">src</span><span class="p">}</span><span class="s2">`</span><span class="p">));</span>
      
        <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
      <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Que puede ser usada para cargar varios scripts. Supongamos que el segundo script usa funciones definidas en el primero. Tenemos que asegurarnos que el segundo script s√≥lo se carga una vez terminada la carga del primero.</p>

<p>En este ejemplo de uso <a href="https://github.com/ULL-ESIT-PL/async-js-series-webpack/blob/master/load-script.html">load-script.html</a> cargamos tres scripts,</p>
<ol>
  <li><a href="https://github.com/ULL-ESIT-PL/async-js-series-webpack/blob/master/script-1.js">script-1.js</a>,</li>
  <li><a href="https://github.com/ULL-ESIT-PL/async-js-series-webpack/blob/master/script-2.js">script-2.js</a> y</li>
  <li><a href="https://github.com/ULL-ESIT-PL/async-js-series-webpack/blob/master/script-3.js">script-3.js</a>:</li>
</ol>

<p>cada uno de los scripts cargados usa el c√≥digo del anterior. Es necesario anidar las callbacks:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>Document<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"out"</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>
      <span class="kd">let</span> <span class="nx">out</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>

      <span class="kd">function</span> <span class="nx">loadScript</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">src</span><span class="p">;</span>
      
        <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">script</span><span class="p">);</span>
        <span class="nx">script</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">`Script load error for </span><span class="p">${</span><span class="nx">src</span><span class="p">}</span><span class="s2">`</span><span class="p">));</span>
      
        <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
      <span class="p">}</span>
           
      <span class="nx">loadScript</span><span class="p">(</span><span class="dl">'</span><span class="s1">script-1.js</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">script</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="nx">error</span> <span class="p">);</span> 
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="s2">`Cool!, the script '</span><span class="p">${</span><span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="p">}</span><span class="s2">' is loaded: "</span><span class="p">${</span><span class="nx">hello</span><span class="p">()}</span><span class="s2">"`</span><span class="p">;</span>
          <span class="nx">out</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">message</span><span class="p">;</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>

          <span class="nx">loadScript</span><span class="p">(</span><span class="dl">'</span><span class="s1">script-2.js</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">script</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="nx">error</span> <span class="p">);</span> 
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="s2">`Great!, the script '</span><span class="p">${</span><span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="p">}</span><span class="s2">' is loaded: "</span><span class="p">${</span><span class="nx">world</span><span class="p">()}</span><span class="s2">"`</span><span class="p">;</span>
              <span class="nx">out</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">`&lt;br/&gt;</span><span class="p">${</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
              <span class="nx">loadScript</span><span class="p">(</span><span class="dl">'</span><span class="s1">script-3.js</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">script</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span> <span class="nx">error</span> <span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                  <span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="s2">`Unbelievable!, the script '</span><span class="p">${</span><span class="nx">script</span><span class="p">.</span><span class="nx">src</span><span class="p">}</span><span class="s2">' is loaded: "</span><span class="p">${</span><span class="nx">ull</span><span class="p">()}</span><span class="s2">"`</span><span class="p">;</span>
                  <span class="nx">out</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">`&lt;br/&gt;</span><span class="p">${</span><span class="nx">message</span><span class="p">}</span><span class="s2">`</span><span class="p">;</span>
                  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
                  <span class="c1">// ...continue after all scripts are loaded </span>
                <span class="p">}</span>
              <span class="p">});</span>
            <span class="p">}</span>
          <span class="p">})</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="nt">&lt;/script&gt;</span>      
  <span class="nt">&lt;/body&gt;</span>  
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Puede ver este c√≥digo en funcionamiento visitando <a href="https://ull-esit-pl.github.io/async-js-series-webpack/load-script.html">https://ull-esit-pl.github.io/async-js-series-webpack/load-script.html</a>. Si lo hace, recuerde abrir las herramientas de desarrollador para ver los mensajes en la c√≥nsola. Juegue con el debugger para entender el funcionamiento.</p>

<p>Puede encontrar mas detalles sobre este ejercicio en el tutorial del profesor en <a href="https://github.com/ULL-ESIT-PL/async-js-series-webpack">https://github.com/ULL-ESIT-PL/async-js-series-webpack</a>.</p>

<h2 id="javascript-is-single-thread-but-the-browser-isnt">JavaScript is Single Thread but the Browser Isn‚Äôt</h2>

<p>Un detalle importante en este c√≥digo ocurre en la asignaci√≥n <code class="language-plaintext highlighter-rouge">script.src = src;</code></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>      <span class="kd">function</span> <span class="nx">loadScript</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">);</span>
      
        <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">script</span><span class="p">);</span>
        <span class="nx">script</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">`Script load error for </span><span class="p">${</span><span class="nx">src</span><span class="p">}</span><span class="s2">`</span><span class="p">));</span>
        <span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">src</span><span class="p">;</span> <span class="cm">/* Fires the concurrent load of the script */</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
      <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Tan pronto como el int√©rprete JS la ejecuta, el browser lanza una thread para la carga de la imagen.
Mientras, el int√©rprete JS contin√∫a su ejecuci√≥n secuencial con la l√≠nea <code class="language-plaintext highlighter-rouge">document.head.append(script);</code> etc.</p>

<p>Cuando la thread de carga de la imagen termina, la correspondiente estructura de datos con la callback (<code class="language-plaintext highlighter-rouge">onload</code>si todo fue bien u <code class="language-plaintext highlighter-rouge">onerror</code> si no se pudo cargar el script) y sus par√°metros es insertada en la Callback Queue al final de la misma (es una cola FIFO).</p>

<p><img src="/assets/images/event-loop.png" alt="" /></p>

<h2 id="escriba-una-funci√≥n-loadscripts">Escriba una funci√≥n <code class="language-plaintext highlighter-rouge">loadScripts</code></h2>

<p>Escriba una funci√≥n <code class="language-plaintext highlighter-rouge">loadScripts([ array-of-urls ], callback)</code> que se llama as√≠:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">out</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">loadScript</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>
      
<span class="kd">function</span> <span class="nx">loadScripts</span><span class="p">(</span><span class="nx">scripts</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="nx">loadScripts</span><span class="p">(</span>
<span class="p">[</span><span class="dl">'</span><span class="s1">script-1.js</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">script-2.js</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">script-3.js</span><span class="dl">'</span><span class="p">],</span> 
<span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">out</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">results</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">src</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;br/&gt;</span><span class="dl">"</span><span class="p">)</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>y que carga los scripts especificados en el array <strong>en secuencia</strong> y llama a la callback pasada como √∫ltimo argumento bien con un error si lo hubo o con el array de argumentos pasados como resultados a las callbacks (en este ejemplo los objetos DOM del tipo <code class="language-plaintext highlighter-rouge">script</code> creados).</p>

<h2 id="serializaci√≥n-de-callbacks">Serializaci√≥n de Callbacks</h2>

<p>Generalize la soluci√≥n anterior para que secuencialice cualquier array de funciones as√≠ncronas.
Esto es, debe funcionar tal como lo hace la funci√≥n <code class="language-plaintext highlighter-rouge">series</code>  del m√≥dulo <a href="/assets/temas/introduccion-a-javascript/async-js">Async.js</a>).</p>

<p>Estudie el m√≥dulo <a href="/assets/temas/introduccion-a-javascript/async-js">Async.js</a> y resuma en el informe lo aprendido.</p>

<p>Esta es la forma de uso de la funci√≥n <code class="language-plaintext highlighter-rouge">series</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nx">series</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="nx">cb</span> <span class="o">=&gt;</span> <span class="nx">loadScript</span><span class="p">(</span><span class="dl">'</span><span class="s1">script-1.js</span><span class="dl">'</span><span class="p">,</span> <span class="nx">cb</span><span class="p">),</span>
        <span class="nx">cb</span> <span class="o">=&gt;</span> <span class="nx">loadScript</span><span class="p">(</span><span class="dl">'</span><span class="s1">script-2.js</span><span class="dl">'</span><span class="p">,</span> <span class="nx">cb</span><span class="p">),</span>
        <span class="nx">cb</span> <span class="o">=&gt;</span> <span class="nx">loadScript</span><span class="p">(</span><span class="dl">'</span><span class="s1">script-3.js</span><span class="dl">'</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">results</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">src</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;br/&gt;</span><span class="dl">"</span><span class="p">)</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="ejemplos-de-prueba">Ejemplos de prueba</h3>

<p>Si hace las pruebas de funcionamiento con scripts de similar tama√±o la probabilidad de que su algoritmo produzca una salida que respeta el orden especificado es alta, <strong>incluso si su algoritmo es err√≥neo</strong>.</p>

<p>Puede simular que los scripts son de distinto tama√±o <strong>retrasando la iniciaci√≥n de las cargas</strong> con un <code class="language-plaintext highlighter-rouge">setTimeout</code> que espere por un n√∫mero aleatorio de milisegundos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>  [~/.../load-script-seq(private)]$ pwd
/Users/casiano/local/src/javascript/learning/async/load-script-seq
[~/.../load-script-seq(private)]$ sed -ne '12,23p' load-scripts.html
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>      <span class="kd">const</span> <span class="nx">ir</span> <span class="o">=</span> <span class="p">(</span><span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">)</span> <span class="o">=&gt;</span>  <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="nx">max</span> <span class="o">-</span> <span class="nx">min</span><span class="p">)</span> <span class="o">+</span> <span class="nx">min</span><span class="p">))</span>
      <span class="kd">let</span> <span class="nx">out</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>

      <span class="kd">function</span> <span class="nx">loadScript</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">src</span><span class="p">,</span> <span class="nx">ir</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">2000</span><span class="p">));</span>

        <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">script</span><span class="p">);</span>
        <span class="nx">script</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">`Script load error for </span><span class="p">${</span><span class="nx">src</span><span class="p">}</span><span class="s2">`</span><span class="p">));</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
      <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="usando-el-m√≥dulo-npm-async-en-el-navegador">Usando el M√≥dulo npm Async en el Navegador</h2>

<p>En el repo  <a href="https://github.com/ULL-ESIT-PL/async-js-series-webpack">ULL-ESIT-PL/async-js-series-webpack</a> encontrara el fichero <code class="language-plaintext highlighter-rouge">dist/index.html</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>‚ûú  load-script-seq git:(master) ‚úó cat dist/index.html 
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
 <span class="nt">&lt;head&gt;</span>
   <span class="nt">&lt;title&gt;</span>Getting Started<span class="nt">&lt;/title&gt;</span>
 <span class="nt">&lt;/head&gt;</span>
 <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">id=</span><span class="s">"out"</span><span class="nt">&gt;&lt;/p&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"main.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
 <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Este fichero contiene en su <code class="language-plaintext highlighter-rouge">body</code> adem√°s del p√°rrafo vac√≠o  <code class="language-plaintext highlighter-rouge">&lt;p id="out"&gt;&lt;/p&gt;</code> 
la carga de un script <code class="language-plaintext highlighter-rouge">main.js</code>. El fichero <code class="language-plaintext highlighter-rouge">main.js</code> se genera mediante el empaquetador
<a href="https://webpack.js.org/guides/getting-started/">webpack</a> a partir de este otro fichero <code class="language-plaintext highlighter-rouge">src/index.js</code>
que importa  la funci√≥n <code class="language-plaintext highlighter-rouge">series</code> del m√≥dulo <a href="/assets/temas/introduccion-a-javascript/async-js">Async</a> usando sint√°xis es6:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>‚ûú  load-script-seq git:(master) ‚úó cat src/index.js 
</pre></td></tr></tbody></table></code></pre></div></div>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">series</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">async-es</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">loadScript</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">script</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">src</span><span class="p">;</span>

    <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">script</span><span class="p">);</span>
    <span class="nx">script</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">`Script load error for </span><span class="p">${</span><span class="nx">src</span><span class="p">}</span><span class="s2">`</span><span class="p">));</span>

    <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">series</span><span class="p">(</span>
  <span class="p">[</span>
     <span class="nx">cb</span> <span class="o">=&gt;</span> <span class="nx">loadScript</span><span class="p">(</span><span class="dl">'</span><span class="s1">script-1.js</span><span class="dl">'</span><span class="p">,</span> <span class="nx">cb</span><span class="p">),</span>
     <span class="nx">cb</span> <span class="o">=&gt;</span> <span class="nx">loadScript</span><span class="p">(</span><span class="dl">'</span><span class="s1">script-2.js</span><span class="dl">'</span><span class="p">,</span> <span class="nx">cb</span><span class="p">),</span>
     <span class="nx">cb</span> <span class="o">=&gt;</span> <span class="nx">loadScript</span><span class="p">(</span><span class="dl">'</span><span class="s1">script-3.js</span><span class="dl">'</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
   <span class="p">],</span>
   <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">p</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">results</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">src</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;br/&gt;</span><span class="dl">"</span><span class="p">)</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Puede ver el resultado de la ejecuci√≥n en el <a href="https://ull-esit-pl.github.io/async-js-series-webpack/">despliegue en <code class="language-plaintext highlighter-rouge">gh-pages</code></a>. Abriendo la ventana del desarrollador ver√° los mensajes en la c√≥nsola.</p>

<p>Tambi√©n puede verlo en local ejecutando <code class="language-plaintext highlighter-rouge">npx webpack serve</code> o bien <code class="language-plaintext highlighter-rouge">npm run start:dev</code> que ejecuta un servidor con el resultado de la compilaci√≥n en el puerto 9000:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>  load-script-seq git:(master) ‚úó npm run start:dev

&gt; sol@1.0.1 start:dev /Users/casianorodriguezleon/campus-virtual/2021/learning/asyncjs-learning/load-script-seq
&gt; webpack serve

‚Ñπ ÔΩ¢wdsÔΩ£: Project is running at http://localhost:9000/
  ...
‚Ñπ ÔΩ¢wdmÔΩ£: Compiled successfully.
</pre></td></tr></tbody></table></code></pre></div></div>

<p><img src="/assets/images/webpack-async.png" alt="" /></p>

<h2 id="bundlers">Bundlers</h2>

<p>Cuando instalamos la dependencia del m√≥dulo <a href="/assets/temas/introduccion-a-javascript/async-js">Async</a> este acaba en el directorio <code class="language-plaintext highlighter-rouge">node_modules/</code>. 
Para usarlo desde el navegador es conveniente usar un <em>bundler</em>. 
Un bundler en JavaScript es una herramienta que pone todo el c√≥digo y  sus dependencias juntas en unos pocos archivos. Hay muchos de ellos en estos d√≠as, siendo los m√°s populares <a href="http://browserify.org/">Browserify</a>, <a href="https://webpack.js.org">Webpack</a>, <a href="https://rollupjs.org/guide/en/">Rollup</a>,
<a href="https://parceljs.org/">Parcel</a> ‚Ä¶ Hist√≥ricamente, JavaScript no ha tenido un est√°ndar para requerir dependencias de su c√≥digo y de ah√≠ la necesidad de los <em>bundlers</em>.</p>

<h3 id="webpack">Webpack</h3>

<p>Siga el tutorial <a href="https://webpack.js.org/guides/getting-started/">Getting Started with Webpack</a> y familiar√≠cese con webpack. Resuma lo aprendido en el informe.</p>

<p>En el repo <a href="https://github.com/ULL-ESIT-PL/async-js-series-webpack">ULL-ESIT-PL/async-js-series-webpack</a> hemos usado Webpack para procesar la soluci√≥n que usa el m√≥dulo Async:</p>

<p>Si ejecutamos webpack con <code class="language-plaintext highlighter-rouge">npm run build</code> o bien <code class="language-plaintext highlighter-rouge">npx webpack</code>, este pasa a copiar los scripts de ejemplos <code class="language-plaintext highlighter-rouge">script-*.js</code>, <code class="language-plaintext highlighter-rouge">load-script.html</code> etc. a la carpeta <code class="language-plaintext highlighter-rouge">dist</code> y a compilar el fichero <code class="language-plaintext highlighter-rouge">./src/index.js</code> empaquet√°ndolo con sus dependencias en el fichero <code class="language-plaintext highlighter-rouge">dist/main.js</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre>‚ûú  load-script-seq git:(master) ‚úó npm run build

&gt; sol@1.0.1 build /Users/casianorodriguezleon/campus-virtual/2021/learning/asyncjs-learning/load-script-seq
&gt; webpack

assets by path *.js 67.7 KiB
  asset main.js 67.5 KiB [emitted] (name: main)
  asset script-3.js 66 bytes [emitted] [from: script-3.js] [copied]
  asset script-2.js 61 bytes [emitted] [from: script-2.js] [copied]
  asset script-1.js 52 bytes [emitted] [from: script-1.js] [copied]
asset favicon.ico 15.1 KiB [emitted] [from: favicon.ico] [copied]
asset load-script.html 1.72 KiB [compared for emit] [from: load-script.html] [copied]
orphan modules 159 KiB [orphan] 85 modules
runtime modules 670 bytes 3 modules
cacheable modules 16.3 KiB
  modules by path ./node_modules/async-es/internal/*.js 7.81 KiB 13 modules
  modules by path ./node_modules/async-es/*.js 7.89 KiB
    ./node_modules/async-es/series.js 2.58 KiB [built] [code generated]
    ./node_modules/async-es/asyncify.js 3.21 KiB [built] [code generated]
    ./node_modules/async-es/eachOfSeries.js 955 bytes [built] [code generated]
    ./node_modules/async-es/eachOfLimit.js 1.16 KiB [built] [code generated]
  ./src/index.js 572 bytes [built] [code generated]
webpack 5.26.3 compiled successfully in 322 ms
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Los ficheros resultantes quedan en la carpeta <code class="language-plaintext highlighter-rouge">dist</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>‚ûú  load-script-seq git:(master) ‚úó tree dist 
dist
‚îú‚îÄ‚îÄ favicon.ico
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ load-script.html
‚îú‚îÄ‚îÄ main.js
‚îú‚îÄ‚îÄ script-1.js
‚îú‚îÄ‚îÄ script-2.js
‚îî‚îÄ‚îÄ script-3.js

0 directories, 7 files
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="webpackconfigjs">webpack.config.js</h3>

<p>Todo este proceso ha sido gobernado por el fichero de configuraci√≥n <code class="language-plaintext highlighter-rouge">webpack.config.js</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>‚ûú  load-script-seq git:(master) ‚úó cat webpack.config.js 
</pre></td></tr></tbody></table></code></pre></div></div>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">CopyPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">copy-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">entry</span><span class="p">:</span>  <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">.</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">src</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">index.js</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// /Users/casianorodriguezleon/campus-virtual/2021/learning/asyncjs-learning/load-script-seq/src/index.js'</span>
  <span class="na">mode</span><span class="p">:</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">main.js</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">dist</span><span class="dl">'</span><span class="p">),</span> <span class="c1">// __dirname contains the path of the folder where this file resides</span>
    <span class="na">clean</span><span class="p">:</span> <span class="kc">true</span> <span class="c1">// clean the dist/ folder before each build</span>
  <span class="p">},</span>
  <span class="na">devServer</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">contentBase</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">dist</span><span class="dl">'</span><span class="p">),</span>
    <span class="na">compress</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="na">port</span><span class="p">:</span> <span class="mi">9000</span>
  <span class="p">},</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">CopyPlugin</span><span class="p">({</span> <span class="na">patterns</span><span class="p">:</span> <span class="p">[</span> <span class="c1">// to: by default is compiler.options.output	which is 'dist/'</span>
      <span class="p">{</span> <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">index.html</span><span class="dl">"</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">from</span><span class="p">:</span> <span class="dl">'</span><span class="s1">script-*.js</span><span class="dl">'</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">favicon.ico</span><span class="dl">"</span> <span class="p">},</span>
      <span class="p">{</span> <span class="na">from</span><span class="p">:</span> <span class="dl">"</span><span class="s2">load-script.html</span><span class="dl">"</span><span class="p">}</span>
    <span class="p">]}),</span>
  <span class="p">],</span>
  <span class="na">devtool</span><span class="p">:</span> <span class="dl">'</span><span class="s1">eval-cheap-module-source-map</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// The devtool option controls if and how source maps are generated.</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span> <span class="c1">// Determines how the different types of modules within a project will be treated</span>
    <span class="na">rules</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="c1">// A loader is a node module that exports a function</span>
        <span class="c1">// This function is called when a resource should be transformed by the loader</span>
        <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">js$/</span><span class="p">,</span> <span class="c1">// Include all modules that pass test assertion</span>
        <span class="na">enforce</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pre</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// Specifies the category of the loader. No value means normal loader.</span>
        <span class="na">use</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">source-map-loader</span><span class="dl">'</span><span class="p">],</span> 
      <span class="p">},</span>
    <span class="p">],</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="packaging-all-modules-in-a-single-js-file">Packaging all modules in a single JS file</h3>

<p>When you run webpack from the command line,</p>

<ol>
  <li>Looks for the <code class="language-plaintext highlighter-rouge">entry</code> in your <code class="language-plaintext highlighter-rouge">webpack.config.js</code> file: <code class="language-plaintext highlighter-rouge">src/index.js</code> and</li>
  <li>
    <p>Builds a dependency graph analyzing the dependencies</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">series</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">async-es</span><span class="dl">"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <ul>
      <li>Our project may have installed dependencies in the <code class="language-plaintext highlighter-rouge">node_modules</code> folder that should not be included in our client-side JavaScript production bundle</li>
      <li>Example: <code class="language-plaintext highlighter-rouge">devDependencies</code> that are used for testing and building.</li>
      <li>Example: Dependencies used only by   our backend like express</li>
    </ul>
  </li>
  <li>Every time webpack finds a new module it runs the module through the <em>loader</em> defined in the webpack config file</li>
  <li>It also removes the <em>dead code</em> that is not used (for example functions that are never called)</li>
  <li>It traverses the dependency graph, pasting the code together and applying the plugins as defined in the config file,</li>
  <li>Finally it spits out the bundle to the path defined in the output section of the webpack config: <code class="language-plaintext highlighter-rouge">dist/main.js</code></li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>‚ûú  load-script-seq git:(master) ‚úó sed -ne '1,13p' dist/main.js 
</pre></td></tr></tbody></table></code></pre></div></div>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="cm">/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */</span>
<span class="cm">/******/</span> <span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// webpackBootstrap</span>
<span class="cm">/******/</span>        <span class="dl">"</span><span class="s2">use strict</span><span class="dl">"</span><span class="p">;</span>
<span class="cm">/******/</span>        <span class="kd">var</span> <span class="nx">__webpack_modules__</span> <span class="o">=</span> <span class="p">({</span>

<span class="cm">/***/</span> <span class="dl">"</span><span class="s2">./node_modules/async-es/asyncify.js</span><span class="dl">"</span><span class="p">:</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="webpack-loaders">Webpack Loaders</h3>

<p>Webpack enables use of <a href="https://webpack.js.org/concepts/loaders">loaders</a> to preprocess files.</p>

<p>Loaders are transformations that are applied to the source code of a module. They allow you to pre-process files as you <code class="language-plaintext highlighter-rouge">import</code> or <em>load</em> them.</p>

<p>Loaders are activated by using <code class="language-plaintext highlighter-rouge">loadername!</code> prefixes in <code class="language-plaintext highlighter-rouge">require()</code> statements. For example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">html-loader!./file.html</span><span class="dl">'</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>or are automatically applied via regex from your webpack configuration like <a href="#webpackconfigjs">above</a></p>

<p>Loaders can</p>

<ul>
  <li>transform files from a different language (like TypeScript) to JavaScript or</li>
  <li>load inline images as data URLs.</li>
  <li>Loaders even allow you to do things like <code class="language-plaintext highlighter-rouge">import</code> CSS files directly from your JavaScript modules</li>
</ul>

<p>It‚Äôs good to keep in mind that webpack‚Äôs loaders are always evaluated from right to left and from bottom to top (when using separate definitions).</p>

<p>The right-to-left rule is easier to remember when you think about loaders as functions. You can read definition</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">use</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">style-loader</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">css-loader</span><span class="dl">"</span><span class="p">]</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>as <code class="language-plaintext highlighter-rouge">style(css(input))</code> based on this rule.</p>

<p>Example:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">css$/</span><span class="p">,</span>
  <span class="na">use</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">style-loader</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">css-loader</span><span class="dl">"</span><span class="p">],</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">enforce</code> field can be used to push processing either before or after other loaders (It can be either <code class="language-plaintext highlighter-rouge">pre</code> or <code class="language-plaintext highlighter-rouge">post</code>).</p>

<p>Linting is a good example because we want the build to fail before it does anything else:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span>
  <span class="nl">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">js$/</span><span class="p">,</span>
  <span class="nx">enforce</span><span class="p">:</span> <span class="dl">"</span><span class="s2">pre</span><span class="dl">"</span><span class="p">,</span> 
  <span class="nx">use</span><span class="p">:</span> <span class="dl">"</span><span class="s2">eslint-loader</span><span class="dl">"</span><span class="p">,</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="debugging-con-webpack">Debugging con Webpack</h3>

<p>En Webpack cuando estamos aplicando una serie de loaders o de transformaciones a nuestro c√≥digo, el c√≥digo generado dista mucho del original: El debugging se convierte en un problema.  Para facilitar la depuraci√≥n es conveniente  configurar <code class="language-plaintext highlighter-rouge">/webpack.config.js</code> con  la opci√≥n <code class="language-plaintext highlighter-rouge">devtool</code> puesta a <code class="language-plaintext highlighter-rouge">eval-cheap-module-source-map</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>```js
+  devtool: 'eval-cheap-module-source-map',
+  module: {
+    rules: [
+      {
+        test: /\.js$/,
+        enforce: 'pre',
+        use: ['source-map-loader'],
+      },
+    ],
+  },
};    ```
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Un <em>source map</em> es una correspondencia que se realiza entre el c√≥digo original y el c√≥digo transformado. V√©ase <a href="https://webpack.js.org/loaders/source-map-loader/">source-map-loader</a></p>

<p><img src="/assets/images/debugging-webpack.png" alt="" /></p>

<p>V√©ase el v√≠deo Webpack dev server y source maps: tutorial pr√°ctico:</p>

<!-- Courtesy of embedresponsively.com //-->

<div class="responsive-video-container">
    <iframe src="https://www.youtube-nocookie.com/embed/bZD8qcJIEIE" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>
  </div>

<h2 id="escriba-su-soluci√≥n-como-un-m√≥dulo-es6">Escriba su soluci√≥n como un m√≥dulo es6</h2>

<p>Reescriba su soluci√≥n al apartado <a href="#serializaci√≥n-de-callbacks">Serializaci√≥n de Callbacks</a> en un m√≥dulo <code class="language-plaintext highlighter-rouge">src/lib/solution.js</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>  [~/.../async/load-script-seq(private)]$ tree src
  src
  ‚îú‚îÄ‚îÄ index.js
  ‚îî‚îÄ‚îÄ lib
      ‚îî‚îÄ‚îÄ solution.js

  1 directory, 2 files
</pre></td></tr></tbody></table></code></pre></div></div>
<p>que sea usado por <code class="language-plaintext highlighter-rouge">src/index.js</code></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="codehilite"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">loadScript</span><span class="p">,</span> <span class="nx">loadScripts</span><span class="p">,</span> <span class="nx">mySeries</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./lib/solution.js</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Using mySeries</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">mySeries</span><span class="p">(</span>
  <span class="p">[</span>
      <span class="nx">cb</span> <span class="o">=&gt;</span> <span class="nx">loadScript</span><span class="p">(</span><span class="dl">'</span><span class="s1">script-1.js</span><span class="dl">'</span><span class="p">,</span> <span class="nx">cb</span><span class="p">),</span>
      <span class="nx">cb</span> <span class="o">=&gt;</span> <span class="nx">loadScript</span><span class="p">(</span><span class="dl">'</span><span class="s1">script-2.js</span><span class="dl">'</span><span class="p">,</span> <span class="nx">cb</span><span class="p">),</span>
      <span class="nx">cb</span> <span class="o">=&gt;</span> <span class="nx">loadScript</span><span class="p">(</span><span class="dl">'</span><span class="s1">script-3.js</span><span class="dl">'</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">out</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">results</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">s</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">src</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">&lt;br/&gt;</span><span class="dl">"</span><span class="p">)</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="referencias">Referencias</h2>

<ul>
  <li><a href="https://github.com/ULL-ESIT-PL/async-js-series-webpack">Repo ULL-ESIT-PL/async-js-series-webpack</a></li>
  <li>La secci√≥n <a href="/assets/temas/introduccion-a-javascript/async-js">The Async Module</a> de estos apuntes</li>
  <li>npm <a href="https://www.npmjs.com/package/async-es">async-es: A pure ESM version of Async</a></li>
  <li><a href="https://webpack.js.org/guides/getting-started/">Webpack: Getting started</a></li>
  <li><a href="https://webpack.js.org/configuration/dev-server/">Webpack devserver</a></li>
  <li>Blog <a href="https://blog.jakoblind.no/how-webpack-decides-what-to-bundle/">How webpack decides what to bundle</a> by Jakob Lind</li>
  <li><a href="https://survivejs.com/webpack/loading/loader-definitions/">Webpack book: Loader Definitions</a></li>
</ul>

<!--
## Soluciones

* [Soluci√≥n](https://github.com/ULL-ESIT-PL/async-js-series-webpack-private/blob/private/load-scripts.html)
* ```
      [~/.../load-script-seq(private)]$ pwd -P
      /Users/casiano/local/src/javascript/learning/async/load-script-seq
  ```
* `/Volumes/2020/sytws/sytws2021/p8-t2-async-serialize-12-03-2020-09-16-48/alu0101040882` Daniel Labena
-->




 
<h2 id="rubrica">R√∫brica</h2>

Incidencias para el Project Board para la pr√°ctica <i><p>Async Serialize</p>
</i>
<ul>
    
    <li><p>La soluci√≥n a <code class="language-plaintext highlighter-rouge">loadscripts</code> funciona correctamente</p>
</li> 
    
    
    <li><p>La soluci√≥n a <code class="language-plaintext highlighter-rouge">mySeries</code> funciona correctamente</p>
</li> 
    
    
    <li><p>La soluci√≥n se ha aislado en un m√≥dulo ES6 y funciona correctamente</p>
</li> 
    
    
    <li><p>Se ha usado WebPack correctamente y se comprende su funcionamiento</p>
</li> 
    
    
    <li><p>Sabe depurar un programa generado con Webpack</p>
</li> 
    
    
</ul>





            </div>


                        
<h2>Comment with GitHub Utterances</h2>
            
<script src="https://utteranc.es/client.js"
        repo="ULL-MII-SYTWS/ull-mii-sytws.github.io"
        issue-term="pathname"
        label="SYTWS"
        theme="dark-blue"
        crossorigin="anonymous"
        async>
</script>
            



 
            
        </section>
    
    </div>


    
</body>

</html>
